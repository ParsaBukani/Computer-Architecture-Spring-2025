`timescale 1ns/1ns

module Adder_TB();
	
	logic [3:0] A = 3'd0, B = 3'd0;
	logic Cin = 1'b0;
	wire [3:0] AddRes;
	wire Cout;
	
	Adder CUT(.a(A), .b(B), .cin(Cin), .res(AddRes), .cout(Cout));
		
	task add_1();
		begin
			$display("Add 1 is starting at time = %t", $time);
			#10 
			A = 3'd5; B = 3'd7;
			#10
			A = 3'd7;
			#20
			$display("Add 1 is end at time = %t", $time);
		end
	endtask
	
	task add_2();
		begin
			$display("Add 2 is starting at time = %t", $time);
			#10 
			A = 3'd9; B = 3'd2; Cin = 1'b1;
			#10
			A = 3'd12; Cin = 1'b0;
			#20
			$display("Add 2 is end at time = %t", $time);
		end
	endtask
	
	initial begin
		$display("Start Adding");
		add_1();
		add_2();
		$display("Finish Adding");
		#1000 
		$stop;
	end

endmodule


module TopModule_tb;

    // Inputs
    reg clk = 0;
    reg rst = 1;
    reg clkPB = 0;
    reg ser_in = 0;

    // Outputs
    wire p0, p1, p2, p3;
    wire SerOutValid, done;
    wire [6:0] SSD1, SSD2;

    // Instantiate the DUT (Device Under Test)
    TopModule uut (
        .clk(clk),
        .rst(rst),
        .clkPB(clkPB),
        .ser_in(ser_in),
        .p0(p0),
        .p1(p1),
        .p2(p2),
        .p3(p3),
        .SerOutValid(SerOutValid),
        .done(done),
        .SSD1(SSD1),
        .SSD2(SSD2)
    );

    // Clock generator
    always #5 clk = ~clk;  // 10ns period

    // Test sequence
    initial begin

        // Initial conditions
        rst = 1;
        clkPB = 0;
        ser_in = 1;
        #20;

        // Release reset
        rst = 0;
        #10;
        ser_in = 0;

        // Simulate button presses and serial input
        repeat (250) begin
            #10 clkPB = 1;
            ser_in = $random % 2; // Random 0 or 1 input
            #10 clkPB = 0;
            #10;
        end

        // Wait and finish
        #200;
        $stop;
    end

endmodule
